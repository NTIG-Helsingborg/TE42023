<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Personal - Start Bootstrap Template</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Custom Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap icons-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <link href="css/timeline.css" rel="stylesheet" />

    <script src="js/navbar.js"></script>
    <script src="js/footer.js"></script>
  </head>
  <body class="d-flex flex-column h-100 bg-light">
    <main class="flex-shrink-0">
      <!-- Navigation-->
      <nav-bar></nav-bar>
      <!-- Page Content-->
      <div class="container px-5 my-5 content-container">
        <div class="text-center mb-5">
          <h1 class="display-5 fw-bolder mb-0">
            <span class="text-gradient d-inline">Tidslinje</span>
          </h1>
        </div>
        <div class="row gx-5 justify-content-center timeline">
          <ul id="timeline2"></ul>
        </div>
      </div>
    </main>
    <!-- Footer-->
    <footer-bar></footer-bar>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const data = await fetch("data.json").then((response) =>
          response.json()
        );
        const section = document.getElementById("timeline2");

        for (const entry of Object.values(data.timeline)) {
          const newCard = document.createElement("li");
          newCard.classList.add("card");
          // There is no modal for företagsbesök, so no point in making it clickable
          if (entry.subtitle != "Företagsbesök" && entry.subtitle != "") {
            newCard.classList.add("can-hover");
          }
          newCard.setAttribute("data-bs-toggle", "modal");
          newCard.setAttribute("data-bs-target", "#modal-" + entry.id);

          newCard.innerHTML = `

              <div class="card-body shadow rounded-4">
                    <div class="row align-items-center gx-5">
                      <div class="col text-center mb-4 mb-lg-0">
                        <div class="bg-light p-4 rounded-4">
                          <div class="text-primary fw-bolder mb-2">
                            ${entry.date}
                          </div>
                          <div class="small fw-bolder">${entry.title}</div>
                          <div class="small text-muted">${entry.subtitle}</div>
                        </div>
                      </div>
                    </div>
                  </div>

              `;
          section.appendChild(newCard);
        }
        for (const entry of Object.values(data.timeline)) {
          //No extra information for företagsbesök, so no popup necessary
          if (entry.subtitle == "Företagsbesök" || entry.subtitle == "")
            continue;
          const newModal = document.createElement("div");
          newModal.classList.add("modal", "fade");
          newModal.setAttribute("id", "modal-" + entry.id);
          newModal.setAttribute("tabindex", "-1");
          newModal.setAttribute("aria-labelledby", "modal-" + entry.id);
          newModal.setAttribute("aria-hidden", "true");

          newModal.innerHTML = `
              <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">
                        ${entry.title}
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <div class="modal-body">
                      ${entry.description}
                    </div>
                    <div class="modal-footer">
                      ${
                        entry.goto_project
                          ? `<a href="projects.html" class="btn btn-primary">Läs mer</a>`
                          : ""
                      }
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>`;
          section.appendChild(newModal);
        }
        // Initialize viewport detection after items are created
        initializeViewportDetection();
      });

      function initializeViewportDetection() {
        "use strict";

        // define variables
        var items = document.querySelectorAll(".timeline li");
        console.log(items.length);

        // check if an element is in viewport
        function isElementInViewport(el) {
          var rect = el.getBoundingClientRect();
          return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <=
              (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <=
              (window.innerWidth || document.documentElement.clientWidth)
          );
        }

        function callbackFunc() {
          for (var i = 0; i < items.length; i++) {
            if (isElementInViewport(items[i])) {
              items[i].classList.add("in-view");
            }
          }
        }
        callbackFunc();
        // listen for events
        window.addEventListener("load", callbackFunc);
        window.addEventListener("resize", callbackFunc);
        window.addEventListener("scroll", callbackFunc);
      }
    </script>
  </body>
</html>
